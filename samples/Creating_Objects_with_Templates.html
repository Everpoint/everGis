<!DOCTYPE html>
<html>
<head>
    <title>sGis Framework - Creating Objects with Templates Sample</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">    
    <style>
        body, html {margin: 0px; overflow: hidden; height: 100%;}
        div#map {width: 100%; height: 100%;}
    </style>

    <script src="http://dev2.everpoint.ru/EverGIS/HTML5/005/evergis.js"></script>


</head>
<body>
    <!--
    Пример создания объекта по шаблону.
   
    -->
    <div id="map"></div>
    <script>
        window.onload = function() {
            
        var sp = new sGis.SpatialProcessor({
            url: 'http://dev2.everpoint.ru/eg_public/SpatialProcessor/IIS/', login: 'jspublic', password: 'jspublic',
            mapWrapper: 'map',
            services: ['osm']
        });

        sp.service.osm.addListener('initialize', function() {
            sp.addController('clientLayer', {serviceName: 'eg_layer1'});
            
            var featureLayer = new sGis.FeatureLayer();
            sp.map.addLayer(featureLayer);

            var polygonControl = new sGis.controls.Polygon(sp.map, {activeLayer: featureLayer, style: {strokeColor: 'blue', fillColor: 'rgba(100, 255, 255, 0.5)', strokeWidth: 5}});
            polygonControl.addListener('drawingFinish', addFeature);
            polygonControl.activate();

            function addFeature(sGisEvent) {
                sp.controller.clientLayer.createObject({
                    object: sGisEvent.geom,
                    templatePath: 'd:\\Startup\\public.assetlib\\fb52ab32-c100-4122-8598-95511f50a8e1.asset',
                    success: function() {
                        alert('Successfully added');
                    },
                    error: function() {
                        alert('Error occured');
                    }
                });
                featureLayer.features = [];
                sp.map.redrawLayer(featureLayer);
            }
        });
        }
    </script>
</body>
</html>
