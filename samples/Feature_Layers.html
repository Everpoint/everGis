<!DOCTYPE html>
<html>
    <head>
        <title>sGis Framework - Feature Layer Sample</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width">
        
        <style>
            body, html {margin: 0px; overflow: hidden; height: 100%;}
            div#map {width: 100%; height: 100%;}
        </style>

        <script src="../Source/sGis/sGis.js"></script>
        <script src="../Source/sGis/Geotools.js"></script>
        <script src="../Source/sGis/RBush.js"></script>
        <script src="../Source/sGis/Event.js"></script>
        <script src="../Source/sGis/utils.js"></script>
        <script src="../Source/sGis/utils/utils.js"></script>
        <script src="../Source/sGis/utils/proto.js"></script>
        <script src="../Source/sGis/utils/svg.js"></script>
        <script src="../Source/sGis/Crs.js"></script>
        <script src="../Source/sGis/IEventHandler.js"></script>
        <script src="../Source/sGis/geom.js"></script>
        <script src="../Source/sGis/Painter.js"></script>
        <script src="../Source/sGis/Layer.js"></script>
        <script src="../Source/sGis/LayerGroup.js"></script>
        <script src="../Source/sGis/Map.js"></script>
        <script src="../Source/sGis/TileLayer.js"></script>
        <script src="../Source/sGis/DynamicLayer.js"></script>
        <script src="../Source/sGis/FeatureLayer.js"></script>
        <script src="../Source/sGis/ESRIDynamicLayer.js"></script>
        <script src="../Source/sGis/Decorations.js"></script>
        <script src="../Source/sGis/geom/Arc.js"></script>
        <script src="../Source/sGis/geom/Point.js"></script>
        <script src="../Source/sGis/geom/Polyline.js"></script>
        <script src="../Source/sGis/geom/Polygon.js"></script>
        <script src="../Source/sGis/symbols/Symbol.js"></script>
        <script src="../Source/sGis/symbols/Maptip.js"></script>
        <script src="../Source/sGis/symbols/Point.js"></script>
        <script src="../Source/sGis/symbols/Polyline.js"></script>
        <script src="../Source/sGis/symbols/Polygon.js"></script>
        <script src="../Source/sGis/features/Feature.js"></script>
        <script src="../Source/sGis/features/Image.js"></script>
        <script src="../Source/sGis/features/FeatureGroup.js"></script>
        <script src="../Source/sGis/features/Point.js"></script>
        <script src="../Source/sGis/features/Polyline.js"></script>
        <script src="../Source/sGis/features/Polygon.js"></script>
        <script src="../Source/sGis/features/Label.js"></script>
        <script src="../Source/sGis/features/Maptip.js"></script>
        <script src="../Source/sGis/features/PointGroup.js"></script>
        <script src="../Source/sGis/controls/Control.js"></script>
        <script src="../Source/sGis/controls/Point.js"></script>
        <script src="../Source/sGis/controls/Polyline.js"></script>
        <script src="../Source/sGis/controls/Polygon.js"></script>
        <script src="../Source/sGis/controls/Editor.js"></script>
        <script src="../Source/sGis/controls/Distance.js"></script>
        <script src="../Source/sGis/controls/Area.js"></script>
        <script src="../Source/sGis/controls/Rectangle.js"></script>
        <script src="../Source/sGis/controls/BaseLayerSwitch.js"></script>

        <script src="../Source/spatialProcessor/Connector.js"></script>
        <script src="../Source/spatialProcessor/utils.js"></script>
        <script src="../Source/spatialProcessor/MapServer.js"></script>
        <script src="../Source/spatialProcessor/DataTree.js"></script>
        <script src="../Source/spatialProcessor/xmlSerializer.js"></script>
        <script src="../Source/spatialProcessor/Sfs.js"></script>
        <script src="../Source/spatialProcessor/Template.js"></script>
        <script src="../Source/spatialProcessor/Printer.js"></script>
        <script src="../Source/spatialProcessor/controller/Controller.js"></script>
        <script src="../Source/spatialProcessor/controller/Identify.js"></script>
        <script src="../Source/spatialProcessor/controller/SuperSearch.js"></script>
        <script src="../Source/spatialProcessor/controller/DitIntegration.js"></script>
        <script src="../Source/spatialProcessor/controller/ClientLayer.js"></script>
        <script src="../Source/spatialProcessor/controller/DefinitionQuery.js"></script>
        <script src="../Source/spatialProcessor/controller/TableView.js"></script>
        <script src="../Source/spatialProcessor/DataAccessService.js"></script>

        <script src="../Source/spatialProcessor/mapItem/MapItem.js"></script>
        <script src="../Source/spatialProcessor/mapItem/Folder.js"></script>
        <script src="../Source/spatialProcessor/mapItem/MapServer.js"></script>
        <script src="../Source/spatialProcessor/mapItem/ClientLayer.js"></script>
        <script src="../Source/spatialProcessor/mapItem/DynamicServiceLayer.js"></script>

        <script src="../Source/spatialProcessor/SpatialProcessor.js"></script>

        <script src="../Source/spatialProcessor/Application.js"></script>

    </head>
    <body>
        <!--
            Пример работы с геометрией
        -->
        <div id="map"></div>
        <input id="drawButton" type="button" value="Нарисовать случайный прямоугольник" style="position: absolute; top: 15px; right: 15px;"/>
        <script>
            window.onload = function() {
            
            var sp = new sGis.SpatialProcessor({
                url: 'http://dev2.everpoint.ru/eg_public/SpatialProcessor/IIS/', login: 'jspublic', password: 'jspublic',
                mapWrapper: 'map',
                services: ['osm']
            });
                
            var featureLayer = new sGis.FeatureLayer({features: [
                        new sGis.feature.Point([55.755831, 37.617673], {color: 'red', size: 10})
                ]});
            
            sp.map.addLayer(featureLayer);
                
            var editor = new sGis.controls.Editor(sp.map, {activeLayer: featureLayer});
                editor.activate();
            
            document.getElementById('drawButton').onclick = function() {
                var center = {lat: 55.755831, lon: 37.617673},
                    color = 'rgb(' + rand(256) + ', ' + rand(256) + ', ' + rand(256) + ')',
                    fillColor = 'rgb(' + rand(256) + ', ' + rand(256) + ', ' + rand(256) + ')',
                    lineWidth = rand(5),
                    
                    dx = Math.random() - 0.5,
                    dy = Math.random() - 0.5,
                    size = Math.random();
                    
                var rect = new sGis.feature.Polygon([[center.lat + dy, center.lon + dx], [center.lat + dy, center.lon + dx + size], [center.lat + dy + size, center.lon + dx + size], [center.lat + dy + size, center.lon + dx]], {
                    color: color,
                    fillColor: fillColor,
                    width: lineWidth,
                    symbol: new sGis.symbol.polygon.ImageFill({fillImage: 'http://dev2.everpoint.ru/SandBox/Content/Images/logo1.png'})
                });
            
                featureLayer.add(rect.projectTo(sp.map.crs));
                sp.map.redrawLayer(featureLayer);
            };
            
            function rand(x) {
                return Math.round(Math.random() * x);
            }
            
            }

        </script>
    </body>
</html>
