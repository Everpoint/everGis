<!DOCTYPE html>
<html>
    <head>
        <title>sGis Framework - Point Sample</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width">
        
        <style>
            body, html {margin: 0px; overflow: hidden; height: 100%;}
            div#map {width: 100%; height: 100%;}
            div#output {position: absolute; top: 15px; right: 15px; width: 300px; background-color: rgba(255, 255, 255, 0.7);}
        </style>

        <script src="http://dev2.everpoint.ru/EverGIS/HTML5/005/evergis.js"></script>
    </head>
    <body>
        <!--
            Пример работы с параметрами точки.
        -->
        <div id="map"></div>
        <div id="output"></div>
        <script>
            window.onload = function() {
            
            var sp = new sGis.SpatialProcessor({
                    url: 'http://dev2.everpoint.ru/eg_public/SpatialProcessor/IIS/', login: 'jspublic', password: 'jspublic',
                    mapWrapper: 'map',
                    services: ['osm']
                }),            
                featureLayer = new sGis.FeatureLayer();

            sp.map.addLayer(featureLayer);

            var point = new sGis.feature.Point([55.755831, 37.617673], {size: 20, color: 'blue', style: { strokeWidth: 3, strokeColor: 'red' }});

            point.addListner('dragStart', function(sGisEvent) {
                sGisEvent.draggingObject = this;
            });

            var outputField = document.getElementById('output');

            point.addListner('drag', function(sGisEvent) {
                var projected = point.projectTo(sGis.CRS.webMercator),
                    newPoint = new sGis.Point(projected.x - sGisEvent.offset.x, projected.y - sGisEvent.offset.y, sGisEvent.point.crs),
                    projectedResult = newPoint.projectTo(sGis.CRS.geo);
                point.x = projectedResult.x;
                point.y = projectedResult.y;
                sp.map.redrawLayer(featureLayer);

                outputField.innerHTML = 'Координаты точки: <br>- широта: ' + point.y + ',<br>- долгота: ' + point.x;
            });

            featureLayer.add(point);
            sp.map.redrawLayer(featureLayer);
            
            }
        </script>
    </body>
</html>
