<!DOCTYPE html>
<html>
<head>
    <title>sGis Framework - Identification Sample</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
    <style>
        body, html {margin: 0px; overflow: hidden; height: 100%;}
        div#map {width: 100%; height: 100%;}
    </style>

    <script src="http://dev2.everpoint.ru/EverGIS/HTML5/006/evergis.js"></script>

</head>
<body>
<div id="map"></div>
<script>
    window.onload = function() {

        var sp = new sGis.SpatialProcessor({
            url: 'http://dev2.everpoint.ru/evergis/SpatialProcessor/IIS/', login: 'jspublic', password: 'jspublic',
            services: ['osm']
        });

        sp.service.osm.on('initialize', function() {
            var point = sp.map.position;
            var resolution = sp.map.resolution;

            var width = 700;
            var height = 500;

            var bbox = new sGis.Bbox(point, [point.x + width * resolution, point.y + height * resolution], point.crs);

            var imageUrl = sGis.ESRIDynamicLayer.prototype.getImageUrl.call({_source: sp.service.osm.url + 'MapServer/', getDisplayedLayers: function() { return ''; }}, bbox, resolution);
            var fullUrl = imageUrl + '&_sb=' + sp.connector.sessionId;

            var image = new Image;
            image.src = fullUrl;

            document.getElementById('map').appendChild(image);
        });

    }
</script>
</body>
</html>
