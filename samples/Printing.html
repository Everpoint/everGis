<!DOCTYPE html>
<html>
<head>
    <title>sGis Framework - Controls Sample</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">

    <style>
        body, html {
            margin: 0px;
            overflow: hidden;
            height: 100%;
        }

        div#map {
            width: 100%;
            height: 100%;
        }

        button#getLink {
            position: absolute;
            right: 15px;
            top: 15px;
        }

        #output {
            position: absolute;
            right: 15px;
            top: 40px;
            background-color: #ccc;
        }

    </style>

    <script src="http://dev2.everpoint.ru/EverGIS/HTML5/005/evergis.js"></script>

</head>
<body>
    <!--
        Пример получения изображения для печати.
    -->
    <div id="map"></div>
    <button id="getLink">Получить ссылку</button>
    <div id="output"></div>
    <script>
        window.onload = function() {
            var sp = new sGis.SpatialProcessor({
                url: 'http://dev2.everpoint.ru/eg_public/SpatialProcessor/IIS/', login: 'jspublic', password: 'jspublic',
                mapWrapper: 'map',
                services: ['osm', 'evergisjs_mrc_test']
            });

            var printer = new sGis.spatialProcessor.Printer(sp),
                templates;

            sp.connector.addListner('sessionInitialized', function() {
                printer.getTemplates({
                    success: function(obj) {
                        templates = obj;
                    },
                    error: function(text) {
                        console.log(text);
                    }
                });
            });


            document.getElementById('getLink').onclick =  function() {
                printer.getImage({
                    template: templates['Png'][1],
                    dpi: 120,
                    paperSize: { width: 500 },
                    success: function(link) {
                        document.getElementById('output').innerHTML = '<a target="_blank" href="' + link + '" downaload>Загрузить изображение</a>';
                    }
                });
            };
        }
    </script>
</body>
</html>
