<!DOCTYPE html>
<html>
    <head>
        <title>sGis Framework - Multiple Maps Sample</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width">
        
        <style>
            body, html {margin: 0px; overflow: hidden; height: 100%;}
            div#map1 {position: absolute; width: 100%; top: 0px;}
            div#map2 {position: absolute; width: 100%;}
            div#curtain {height: 4px; width: 100%; cursor: n-resize; border: 1px solid gray; background-color: #ccc;}
        </style>
        
        <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
        <script src="http://code.jquery.com/ui/1.11.1/jquery-ui.js"></script>
        <script src="http://dev2.everpoint.ru/evergis/html5/lib/touchpunch.js"></script>

        <script src="..\Source\sGis\sGis.js"></script>
        <script src="..\Source\sGis\Geotools.js"></script>
        <script src="..\Source\sGis\RBush.js"></script>
        <script src="..\Source\sGis\Event.js"></script>
        <script src="..\Source\sGis\utils.js"></script>
        <script src="..\Source\sGis\utils\utils.js"></script>
        <script src="..\Source\sGis\utils\proto.js"></script>
        <script src="..\Source\sGis\Crs.js"></script>
        <script src="..\Source\sGis\IEventHandler.js"></script>
        <script src="..\Source\sGis\geom.js"></script>
        <script src="..\Source\sGis\Painter.js"></script>
        <script src="..\Source\sGis\Layer.js"></script>
        <script src="..\Source\sGis\LayerGroup.js"></script>
        <script src="..\Source\sGis\Map.js"></script>
        <script src="..\Source\sGis\TileLayer.js"></script>
        <script src="..\Source\sGis\DynamicLayer.js"></script>
        <script src="..\Source\sGis\FeatureLayer.js"></script>
        <script src="..\Source\sGis\ESRIDynamicLayer.js"></script>
        <script src="..\Source\sGis\Decorations.js"></script>
        <script src="..\Source\sGis\geom\Arc.js"></script>
        <script src="..\Source\sGis\geom\Point.js"></script>
        <script src="..\Source\sGis\geom\Polyline.js"></script>
        <script src="..\Source\sGis\geom\Polygon.js"></script>
        <script src="..\Source\sGis\symbols\Symbol.js"></script>
        <script src="..\Source\sGis\symbols\Maptip.js"></script>
        <script src="..\Source\sGis\symbols\Point.js"></script>
        <script src="..\Source\sGis\symbols\Polyline.js"></script>
        <script src="..\Source\sGis\symbols\Polygon.js"></script>
        <script src="..\Source\sGis\features\Feature.js"></script>
        <script src="..\Source\sGis\features\Image.js"></script>
        <script src="..\Source\sGis\features\FeatureGroup.js"></script>
        <script src="..\Source\sGis\features\Point.js"></script>
        <script src="..\Source\sGis\features\Polyline.js"></script>
        <script src="..\Source\sGis\features\Polygon.js"></script>
        <script src="..\Source\sGis\features\Label.js"></script>
        <script src="..\Source\sGis\features\Maptip.js"></script>
        <script src="..\Source\sGis\features\PointGroup.js"></script>
        <script src="..\Source\sGis\controls\Control.js"></script>
        <script src="..\Source\sGis\controls\Point.js"></script>
        <script src="..\Source\sGis\controls\Polyline.js"></script>
        <script src="..\Source\sGis\controls\Polygon.js"></script>
        <script src="..\Source\sGis\controls\Editor.js"></script>
        <script src="..\Source\sGis\controls\Distance.js"></script>
        <script src="..\Source\sGis\controls\Area.js"></script>
        <script src="..\Source\sGis\controls\Rectangle.js"></script>
        <script src="..\Source\sGis\controls\BaseLayerSwitch.js"></script>

        <script src="..\Source\spatialProcessor\Connector.js"></script>
        <script src="..\Source\spatialProcessor\MapServer.js"></script>
        <script src="..\Source\spatialProcessor\DataTree.js"></script>
        <script src="..\Source\spatialProcessor\xmlSerializer.js"></script>
        <script src="..\Source\spatialProcessor\Sfs.js"></script>
        <script src="..\Source\spatialProcessor\Template.js"></script>
        <script src="..\Source\spatialProcessor\Printer.js"></script>
        <script src="..\Source\spatialProcessor\controller\Controller.js"></script>
        <script src="..\Source\spatialProcessor\controller\Identify.js"></script>
        <script src="..\Source\spatialProcessor\controller\SuperSearch.js"></script>
        <script src="..\Source\spatialProcessor\controller\DitIntegration.js"></script>
        <script src="..\Source\spatialProcessor\controller\ClientLayer.js"></script>
        <script src="..\Source\spatialProcessor\controller\DefinitionQuery.js"></script>
        <script src="..\Source\spatialProcessor\controller\TableView.js"></script>
        <script src="..\Source\spatialProcessor\DataAccessService.js"></script>

        <script src="..\Source\spatialProcessor\mapItem\MapItem.js"></script>
        <script src="..\Source\spatialProcessor\mapItem\Folder.js"></script>
        <script src="..\Source\spatialProcessor\mapItem\MapServer.js"></script>
        <script src="..\Source\spatialProcessor\mapItem\ClientLayer.js"></script>
        <script src="..\Source\spatialProcessor\mapItem\DynamicServiceLayer.js"></script>

        <script src="..\Source\spatialProcessor\SpatialProcessor.js"></script>

        <script src="..\Source\spatialProcessor\Application.js"></script>

    </head>
    <body>
        <!--
        
        Пример работы с несколькими картами одновременно.
        
        -->
        
        <div id="map1"></div>
        <div id="curtain"></div>
        <div id="map2"></div>
        <script>
            window.onload = function() {
            
                var $map1 = $('#map1'),
                    $map2 = $('#map2'),
                    $curtain = $('#curtain'),
                    windowHeight = $(document.body).height();

                $map1.height(windowHeight / 2 - 3);
                $map2.height(windowHeight / 2 - 3).offset({top: windowHeight / 2 + 3});
                $curtain.offset({top: windowHeight / 2 - 3});

                $("#curtain").draggable({
                    axis: 'y',
                    drag: updateSize,
                    stop: updateSize
                });

                function updateSize() {
                    var offset = $curtain.offset().top;
                    $map1.height(offset);
                    $map2.height(windowHeight - offset - 6).offset({top: offset + 6});  
                }

                var sp1 = new sGis.SpatialProcessor({
                    url: 'http://dev2.everpoint.ru/eg_public/SpatialProcessor/IIS/', login: 'jspublic', password: '1jspublic',
                    mapWrapper: 'map1',
                    services: ['osm']
                }),
                    sp2 = new sGis.SpatialProcessor({
                    url: 'http://dev2.everpoint.ru/eg_public/SpatialProcessor/IIS/', login: 'jspublic', password: '1jspublic',
                    mapWrapper: 'map2',
                    services: ['esri_gray']
                });

                sp1.map.addListener('bboxChange', synchronizePosition);
                sp2.service.esri_gray.addListener('initialize', synchronizePosition);
                
                var changing = null;
                
                function synchronizePosition(sGisEvent) {
                    if (changing !== sp2.map) {
                        var position = sp1.map.position;
                        if (sGisEvent.isSizeChange) position.x = sp2.map.position.x;
                        position.y -= (sp1.map.height + sp2.map.height) / 2 * sp1.map.resolution;
                        changing = sp1.map;
                        sp2.map.setPosition(position, sp1.map.resolution);
                        changing = null;
                    }
                }
                
                sp2.map.addListener('bboxChange', backSynchronizePosition);

                function backSynchronizePosition(sGisEvent) {
                    if (changing !== sp1.map && !sGisEvent.isSizeChange) {
                        var position = sp2.map.position;
                        position.y += (sp1.map.height + sp2.map.height) / 2 * sp2.map.resolution;
                        changing = sp2.map;
                        sp1.map.setPosition(position, sp2.map.resolution);
                        changing = null;
                    }
                }

                $(window).resize(function() {
                    windowHeight = $(document.body).height();
                    updateSize();
                });
            }
        </script>
    </body>
</html>
