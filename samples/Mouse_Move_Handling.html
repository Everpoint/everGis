<!DOCTYPE html>
<html>
<head>
    <title>sGis Framework - Mouse Events Sample</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">

    <style>
        body, html {
            margin: 0px;
            overflow: hidden;
            height: 100%;
        }

        div#map {
            width: 100%;
            height: 100%;
        }
    </style>

    <script src="http://dev2.everpoint.ru/EverGIS/HTML5/005/evergis.js"></script>

</head>
<body>
    <!--
        Пример работы с событиями mouseover и mouseout.
    -->
    <div id="map"></div>
    <script>
        window.onload = function() {

            var sp = new sGis.SpatialProcessor({
                    url: 'http://dev2.everpoint.ru/eg_public/SpatialProcessor/IIS/', login: 'jspublic', password: 'jspublic',
                    mapWrapper: 'map',
                    services: ['osm']
                }),
                featureLayer = new sGis.FeatureLayer();

            sp.service.osm.addListener('initialize', function() {
                var POINT_NUMBER = 500;
                var POLYGON_NUMBER = 100;
                var symbol = new sGis.symbol.point.Image({renderToCanvas: false});

                for (var i = 0; i < POINT_NUMBER; i++) {
                    var point = new sGis.feature.Point(getRandomCoordinates(), { crs: sp.map.crs, symbol: symbol });
                    point.addListener('mouseover', pointmouseover);
                    point.addListener('mouseout', pointmouseout);

                    featureLayer.add(point);
                }

                for (var i = 0; i < POLYGON_NUMBER; i++) {
                    var point = getRandomCoordinates();
                    var polygon = new sGis.feature.Polygon([point, [point[0] + 10000, point[1] + 10000], [point[0] + 20000, point[1]]], { crs: sp.map.crs, fillColor: 'blue' });
                    polygon.addListener('mouseover', polygonmouseover);
                    polygon.addListener('mouseout', polygonmouseout);

                    featureLayer.add(polygon);
                }

                sp.map.addLayer(featureLayer);

                function pointmouseover(sGisEvent) {
                    this.size = 64;
                    sp.map.redrawLayer(featureLayer);
                }

                function pointmouseout(sGisEvent) {
                    this.size = 32;
                    sp.map.redrawLayer(featureLayer);
                }

                function polygonmouseover() {
                    this.fillColor = 'green';
                    sp.map.redrawLayer(featureLayer);
                }

                function polygonmouseout() {
                    this.fillColor = 'blue';
                    sp.map.redrawLayer(featureLayer);
                }

                function getRandomCoordinates() {
                    var bbox = sp.map.bbox;
                    var width = bbox.width * 4;
                    var height = bbox.height * 4;

                    var x = bbox.p[0].x + width * Math.random();
                    var y = bbox.p[0].y + height * Math.random();
                    return [x, y];
                }

            });

        }
    </script>
</body>
</html>
