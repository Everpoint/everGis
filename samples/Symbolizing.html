<!DOCTYPE html>
<html>
<head>
    <title>sGis Framework - Client Layer Editing Sample</title>
    <meta charset="UTF-8">
    <style>
        body, html {
            margin: 0px;
            overflow: hidden;
            height: 100%;
        }

        div#map {
            width: 100%;
            height: 100%;
        }
    </style>
    <script src="http://dev2.everpoint.ru/EverGIS/HTML5/005/evergis.js"></script>

</head>
<body>
    <!--
    Пример редактирования клиентского слоя.
    -->
    <div id="map"></div>
    <script>
        window.onload = function() {

            sGis.spatialProcessor.Connector.prototype.apiLoginUrl = 'http://localhost:80/Strategis.JsClient/ApiLogin.aspx';

            var sp = new sGis.SpatialProcessor({
                url: 'http://localhost/spatialprocessor/',
                login: 'z', password: 'z',
                mapWrapper: 'map',
                services: ['osm']
            });


        //var sp = new sGis.SpatialProcessor({
        //    url: 'http://dev2.everpoint.ru/eg_public/SpatialProcessor/IIS/', login: 'jspublic', password: 'jspublic',
        //    mapWrapper: 'map',
        //    services: ['osm']
        //});

        //sGis.spatialProcessor.Connector.prototype.apiLoginUrl = 'http://chuck-pc.everpoint.ru/Strategis.JsClient/ApiLogin.aspx';

        //var sp = new sGis.SpatialProcessor({
        //    url: 'http://chuck-pc.everpoint.ru/spatialprocessor/', login: 'new', password: 'new',
        //    mapWrapper: 'map',
        //    services: ['osm']
        //});

        //sp.service.osm.addListener('initialize', function() {
        //    var editor = new sGis.controls.Editor(sp.map),
        //        featureLayer = new sGis.FeatureLayer(),
        //        lastSelectedId;
        //    sp.map.addLayer(featureLayer);
        //    editor.activeLayer = featureLayer;

        //    var controller = sp.addController('clientLayer', { serviceName: 'Moscow_Districts_EG_1' });
        //    //var controller = sp.addController('clientLayer', { serviceName: 'mmm' });

        //    //controller.queryGeometryTypes({
        //    //    success: function(types) {
        //    //        alert(JSON.stringify(types));
        //    //    }
        //    //});
            
        //    //controller.queryAttributes({
        //    //    success: function(data) {
        //    //        alert(JSON.stringify(data));
        //    //    }
        //    //});

        //    //controller.getClassifiableProperties({
        //    //    geometryType: 'polygon',
        //    //    success: function(properties) {
        //    //        alert(JSON.stringify(properties));
        //    //    }
        //    //});

        //    //controller.getClassifiers({
        //    //    geometryType: 'polygon',
        //    //    propertyName: 'Fill',
        //    //    success: function(properties) {
        //    //        properties[0].AttributeName = 'SHAPE.area';
        //    //        properties[0].Settings.ClassesCount = 15;
        //    //        properties[0].Settings.SelectedColorRamp.ColorSchema.Palette = [
        //    //            {  
        //    //                "Color":"#ffffff00",
        //    //                "Offset":0
        //    //            },
        //    //            {  
        //    //                "Color":"#ffffffaa",
        //    //                "Offset":0.5
        //    //            },
        //    //            {  
        //    //                "Color":"#ffffffff",
        //    //                "Offset":1
        //    //            }
        //    //        ];
        //    //        getTable(properties[0])
        //    //    }
        //    //});

        //    controller.getClassifiers({
        //        geometryType: 'polygon',
        //        propertyName: 'Fill',
        //        success: function(properties) {
        //            properties[1].AttributeName = 'NAMEAO';
        //            properties[1].Settings.SelectedColorRamp.ColorSchema.Palette = [
        //                {  
        //                    "Color":"#ffff0000",
        //                    "Offset":0
        //                },
        //                {  
        //                    "Color":"#ff00ff00",
        //                    "Offset":0.2
        //                },
        //                {  
        //                    "Color":"#ff0000ff",
        //                    "Offset":0.4
        //                },
        //                {
        //                    "Color": "#ffffff00",
        //                    "Offset": 0.6
        //                },
        //                {
        //                    "Color": "#ffff00ff",
        //                    "Offset": 0.8
        //                },
        //                {
        //                    "Color": "#ff00ffff",
        //                    "Offset": 1
        //                }
        //            ];
        //            getTable(properties[1])
        //        }
        //    });

        //    function getTable(settings) {
        //        controller.buildClassifierTable({
        //            geometryType: 'polygon',
        //            settings: [settings],
        //            success: function(table) {
        //                applySymbolizer(table);
        //            }
        //        });
        //    }

        //    function applySymbolizer(table) {
        //        controller.applySymbolizer({
        //            tables: {
        //                polygon: [table]
        //            }
        //        });
        //    }
        //});

        };
    </script>
</body>
</html>
