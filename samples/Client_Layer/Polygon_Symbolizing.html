<!DOCTYPE html>
<html>
<head>
    <title>sGis Framework - Polygon Symbolizing</title>
    <meta charset="UTF-8">
    <style>
        body, html {
            margin: 0px;
            overflow: hidden;
            height: 100%;
        }

        div#map {
            width: 100%;
            height: 100%;
        }
    </style>
    <script src="http://dev2.everpoint.ru/EverGIS/HTML5/005/evergis.js"></script>

</head>
<body>
    <!--
    Пример символизации полигонов.
    -->
    <div id="map"></div>
    <script>
    window.onload = function() {

        var sp = new sGis.SpatialProcessor({
            url: 'http://dev2.everpoint.ru/eg_public/SpatialProcessor/IIS/', login: 'jspublic', password: 'jspublic',
            mapWrapper: 'map',
            services: ['osm', 'evergisjs_mrc_test']
        });

        sp.service.evergisjs_mrc_test.addListner('initialize', function() {
            sp.service.evergisjs_mrc_test.display = false;

            var clientLayer = sp.addController('clientLayer');
            clientLayer.copy({
                storageId: sp.service.evergisjs_mrc_test.layerInfo[2].LayerInfo.storageId,
                success: function() {
                    applySymbolization();
                }
            });

            function applySymbolization() {
                clientLayer.getClassifiers({
                    geometryType: 'polygon',
                    propertyName: 'Fill',
                    success: function(properties) {
                        properties[1].AttributeName = 'NAMEAO';
                        properties[1].Settings.SelectedColorRamp.ColorSchema.Palette = palette;
                        getTable(properties[1])
                    }
                });

                function getTable(settings) {
                    clientLayer.buildClassifierTable({
                        geometryType: 'polygon',
                        settings: [settings],
                        success: function(table) {
                            applySymbolizer(table);
                        }
                    });
                }

                function applySymbolizer(table) {
                    clientLayer.applySymbolizer({
                        tables: {
                            polygon: [table]
                        }
                    });
                }
            }
        });

        var palette = [
                            {
                                "Color": "#ffff0000",
                                "Offset": 0
                            },
                            {
                                "Color": "#ff00ff00",
                                "Offset": 0.2
                            },
                            {
                                "Color": "#ff0000ff",
                                "Offset": 0.4
                            },
                            {
                                "Color": "#ffffff00",
                                "Offset": 0.6
                            },
                            {
                                "Color": "#ffff00ff",
                                "Offset": 0.8
                            },
                            {
                                "Color": "#ff00ffff",
                                "Offset": 1
                            }
        ];

    };
    </script>
</body>
</html>
