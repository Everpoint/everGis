<!DOCTYPE html>
<html>
    <head>
        <title>sGis Framework - Map Tip Sample</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width">

        <style>
            body, html {margin: 0px; overflow: hidden; height: 100%;}
            div#map {width: 100%; height: 100%;}
        </style>

        <script src="../Source/sGis/sGis.js"></script>
        <script src="../Source/sGis/Geotools.js"></script>
        <script src="../Source/sGis/RBush.js"></script>
        <script src="../Source/sGis/Event.js"></script>
        <script src="../Source/sGis/utils.js"></script>
        <script src="../Source/sGis/utils/utils.js"></script>
        <script src="../Source/sGis/utils/proto.js"></script>
        <script src="../Source/sGis/utils/svg.js"></script>
        <script src="../Source/sGis/Crs.js"></script>
        <script src="../Source/sGis/IEventHandler.js"></script>
        <script src="../Source/sGis/geom.js"></script>
        <script src="../Source/sGis/Painter.js"></script>
        <script src="../Source/sGis/Layer.js"></script>
        <script src="../Source/sGis/LayerGroup.js"></script>
        <script src="../Source/sGis/Map.js"></script>
        <script src="../Source/sGis/TileLayer.js"></script>
        <script src="../Source/sGis/DynamicLayer.js"></script>
        <script src="../Source/sGis/FeatureLayer.js"></script>
        <script src="../Source/sGis/ESRIDynamicLayer.js"></script>
        <script src="../Source/sGis/Decorations.js"></script>
        <script src="../Source/sGis/geom/Arc.js"></script>
        <script src="../Source/sGis/geom/Point.js"></script>
        <script src="../Source/sGis/geom/Polyline.js"></script>
        <script src="../Source/sGis/geom/Polygon.js"></script>
        <script src="../Source/sGis/symbols/Symbol.js"></script>
        <script src="../Source/sGis/symbols/Maptip.js"></script>
        <script src="../Source/sGis/symbols/Point.js"></script>
        <script src="../Source/sGis/symbols/Polyline.js"></script>
        <script src="../Source/sGis/symbols/Polygon.js"></script>
        <script src="../Source/sGis/features/Feature.js"></script>
        <script src="../Source/sGis/features/Image.js"></script>
        <script src="../Source/sGis/features/FeatureGroup.js"></script>
        <script src="../Source/sGis/features/Point.js"></script>
        <script src="../Source/sGis/features/Polyline.js"></script>
        <script src="../Source/sGis/features/Polygon.js"></script>
        <script src="../Source/sGis/features/Label.js"></script>
        <script src="../Source/sGis/features/Maptip.js"></script>
        <script src="../Source/sGis/features/PointGroup.js"></script>
        <script src="../Source/sGis/controls/Control.js"></script>
        <script src="../Source/sGis/controls/Point.js"></script>
        <script src="../Source/sGis/controls/Polyline.js"></script>
        <script src="../Source/sGis/controls/Polygon.js"></script>
        <script src="../Source/sGis/controls/Editor.js"></script>
        <script src="../Source/sGis/controls/Distance.js"></script>
        <script src="../Source/sGis/controls/Area.js"></script>
        <script src="../Source/sGis/controls/Rectangle.js"></script>
        <script src="../Source/sGis/controls/BaseLayerSwitch.js"></script>

        <script src="../Source/spatialProcessor/Connector.js"></script>
        <script src="../Source/spatialProcessor/utils.js"></script>
        <script src="../Source/spatialProcessor/MapServer.js"></script>
        <script src="../Source/spatialProcessor/DataTree.js"></script>
        <script src="../Source/spatialProcessor/xmlSerializer.js"></script>
        <script src="../Source/spatialProcessor/Sfs.js"></script>
        <script src="../Source/spatialProcessor/Template.js"></script>
        <script src="../Source/spatialProcessor/Printer.js"></script>
        <script src="../Source/spatialProcessor/controller/Controller.js"></script>
        <script src="../Source/spatialProcessor/controller/Identify.js"></script>
        <script src="../Source/spatialProcessor/controller/SuperSearch.js"></script>
        <script src="../Source/spatialProcessor/controller/DitIntegration.js"></script>
        <script src="../Source/spatialProcessor/controller/ClientLayer.js"></script>
        <script src="../Source/spatialProcessor/controller/DefinitionQuery.js"></script>
        <script src="../Source/spatialProcessor/controller/TableView.js"></script>
        <script src="../Source/spatialProcessor/DataAccessService.js"></script>

        <script src="../Source/spatialProcessor/mapItem/MapItem.js"></script>
        <script src="../Source/spatialProcessor/mapItem/Folder.js"></script>
        <script src="../Source/spatialProcessor/mapItem/MapServer.js"></script>
        <script src="../Source/spatialProcessor/mapItem/ClientLayer.js"></script>
        <script src="../Source/spatialProcessor/mapItem/DynamicServiceLayer.js"></script>

        <script src="../Source/spatialProcessor/SpatialProcessor.js"></script>

        <script src="../Source/spatialProcessor/Application.js"></script>

    </head>
    <body>
        <!--
            Пример работы с баллунами
        -->
        <div id="map"></div>
        <script>
            window.onload = function() {

            
            sp = new sGis.SpatialProcessor({
                url: 'http://dev2.everpoint.ru/eg_public/SpatialProcessor/IIS/', login: 'jspublic', password: '1jspublic',
                mapWrapper: 'map',
                services: ['osm']
            });
            featureLayer = new sGis.FeatureLayer();
            point = new sGis.feature.Point([55.755831, 37.617673], {symbol: new sGis.symbol.point.Image()});
            maptip = new sGis.feature.Maptip([55.755831, 37.617673], {hidden: true, style: {width: 200, height: 225, offset: {x: -250, y: -220}}});
        
            var html = '<b>Москва</b><br>столица нашей родины</b>\
                        <img src="http://upload.wikimedia.org/wikipedia/commons/b/bb/Coat_of_Arms_of_Moscow.svg" \
                        width="150" height="150"><input type="button" value="Закрыть" onclick="hide()" />';


            maptip.content = html;
            
            point.addListener('click', function() {
                maptip.show();
                sp.map.redrawLayer(featureLayer);
            });
            
            maptip.addListener('dragStart', function(sGisEvent) {
                sGisEvent.draggingObject = this;
                sGisEvent.stopPropagation();                        
            });
            maptip.addListener('drag', function(sGisEvent) {
                maptip.style.offset = {x: maptip.style.offset.x - sGisEvent.offset.xPx, y: maptip.style.offset.y - sGisEvent.offset.yPx};
                sp.map.redrawLayer(featureLayer);
            });
                                
            
            featureLayer.add([point, maptip]);
            
            sp.map.addLayer(featureLayer);

            }
            
            function hide() {
                maptip.hide();
                sp.map.redrawLayer(featureLayer);
            };            
        </script>
    </body>
</html>
